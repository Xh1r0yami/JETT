{% extends "base.html" %}
{% load static %}
{% block title %}Cari Kerja{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'jobs/seeker/css/job_list.css' %}">

<section class="search-hero">
  <form method="GET" class="search-form">

    <div class="search-field">
      <label>Cari pekerjaan apa?</label>
      <input type="text" name="q" placeholder="Masukkan kata kunci"
             value="{{ request.GET.q }}">
    </div>

    <div class="search-field">
      <label>Di mana?</label>
      <select name="location">
        <option value="">Semua kota</option>
        {% for value,label in location_choices %}
          <option value="{{ value }}"
            {% if request.GET.location == value %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </div>

    <button class="btn-search">Cari</button>
  </form>
</section>

<section class="job-list-wrapper">
  <h1 class="section-title">Lowongan yang tersedia</h1>

  <div class="job-list">
    {% for job in jobs %}
      <div class="job-card">

        <div>
          <h2 class="job-title">{{ job.title }}</h2>

          <!-- NAMA PERUSAHAAN -->
          <p class="company-name">{{ job.company.full_name }}</p>
          <p>{{ job.get_job_type_display }}</p>
          <p>{{ job.get_location_display }}</p>
          <p>{{ job.get_salary_range_display }}</p>
        </div>

        <button class="btn-detail" onclick="openModal('{{ job.id }}')">
          Lihat Detail
        </button>
      </div>

      <div class="modal" id="modal-{{ job.id }}">
        <div class="modal-content">

          <span class="close" onclick="closeModal('{{ job.id }}')">&times;</span>

          <div class="modal-header">
            <div>
              <h2>{{ job.title }}</h2>
              
              <!-- NAMA PERUSAHAAN -->
              <p class="company-name">{{ job.company.full_name }}</p>
              <p>{{ job.get_job_type_display }}</p>
              <p>{{ job.get_location_display }}</p>
              <p class="salary">{{ job.get_salary_range_display }}</p>
              <p class="date">Dibuat {{ job.created_at|date:"d M Y" }}</p>
            </div>

            <div>
              {% if job.company.company_profile.logo %}
                <img src="{{ job.company.company_profile.logo.url }}"
                     class="company-logo">
              {% else %}
                <div class="company-logo-placeholder">
                  {{ job.company.full_name|slice:":1" }}
                </div>
              {% endif %}
            </div>
          </div>

          <a href="{% url 'applications:apply_job' job.id %}"
             class="btn-apply">
            Lamar
          </a>

          <div class="modal-section">
            <h3>Deskripsi Tugas</h3>
            <p class="multiline">{{ job.tasks }}</p>
          </div>

          <div class="modal-section">
            <h3>Persyaratan</h3>
            <p class="multiline">{{ job.requirements }}</p>
          </div>

        </div>
      </div>
    {% empty %}
      <p class="empty-text">Lowongan tidak ditemukan.</p>
    {% endfor %}
  </div>
</section>

<script>
function openModal(id) {
  document.getElementById("modal-" + id).style.display = "flex";
}
function closeModal(id) {
  document.getElementById("modal-" + id).style.display = "none";
}
</script>

{% endblock %}
